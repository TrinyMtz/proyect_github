
##     Alineamiento multiple

# Programa que a partir de un archivo FASTA concatenado de secuencias que se 
# anexa a esta actividad haga lo siguiente:
library(Biostrings)  

fasta <- readDNAStringSet("archivos_extra/FASTA.fa") # Cargar archivo externo

alphabetFrequency(fasta) # Ver caracteres

# SIN ABC IUPAC
fasta1 <- chartr("R","C", fasta) # Remplazar las R
fasta2 <- chartr("S","C", fasta1) # Remplazar las S
fasta_dna <- chartr("Y","C", fasta2) # Remplazar las Y

alphabetFrequency(fasta_dna) # Verificar

# (a) El numero de veces que aparece la secuencia GATTACA
secuencia <- DNAString("GATTACA") 



# (b) La secuencia traducida
fasta_aa <- translate(fasta_dna) # Sec de AA  
fasta_aa

# (c) El alineamiento multp con algoritmos distintos para la secuencia de AA
library(msa)

alig_aa1 <- msa(fasta_aa, method = "ClustalW")
msa(fasta_aa, method = "Muscle") 
msa(fasta_aa, method = "ClustalOmega")

# (d) Una matriz de distancias de las secuencias
library(seqinr)

# Para AA
alig_aa <- msaConvert(alig_aa1, type="seqinr::alignment") # Convertir a clase "Aligment" para poder hacer la matriz de dist
class(alig_aa) # Verificar clase

mat_aa <- dist.alignment(alig_aa, "identity")
mat_aa

# Lo mismo que  antes pero con DNA
alig_dna1 <- msa(fasta_dna, method = "ClustalW")
alig_dna <- msaConvert(alig_dna1, type="seqinr::alignment") # Convertir a clase "Aligment" para poder hacer la matriz de dist
class(alig_dna)

mat_dna <- dist.alignment(alig_dna, "identity")
mat_dna

# (e) Un arbol filogenetico a partir de uno de los alineamientos
library(ape)

# dir.create("Resultados") # Crear mi carpt de result

# Para AA
# pdf("Resultados/Filogenia con AA.pdf") # Crear doc
aa_tree <- nj(mat_aa) # Algoritmo de union de los mas cercanos
plot(aa_tree, main="Arbol filogenetico de proteinas del coronavirus") # Arbol 
# dev.off() # Trerminar doc

# Para DNA
# pdf("Resultados/Filogenia con DNA.pdf") #Crear arch de result
dna_tree <- nj(mat_dna) # Algoritmo de union de los mas cercanos
plot(dna_tree, main="Arbol filogenetico de DNA viral")
# dev.off() # Terminar doc

